Sub ImportTxtFileData()
    Dim filePath As String
    Dim fileContent As String
    Dim dataArray() As String
    Dim rowIndex As Long
    Dim columnIndex As Long
    Dim resultSheet As Worksheet
    
    ' ファイル選択ダイアログを表示し、txtファイルを選択させる
    With Application.FileDialog(msoFileDialogFilePicker)
        .Title = "txtファイルを選択してください"
        .Filters.Add "テキストファイル", "*.txt"
        If .Show = -1 Then
            filePath = .SelectedItems(1)
        Else
            Exit Sub ' ファイルが選択されなかった場合、処理を終了
        End If
    End With
    
    ' テキストファイルを1行ずつ読み込む（BOM付きのUTF-8対応）
    With CreateObject("ADODB.Stream")
        .Charset = "UTF-8"
        .Open
        .LoadFromFile filePath
        fileContent = .ReadText
        .Close
    End With
    
    ' テキストを改行文字で分割し、データを配列に格納する
    dataArray = Split(fileContent, vbCrLf)
    
    ' "result"という新しいシートを作成する
    Set resultSheet = ThisWorkbook.Sheets.Add(After:=ThisWorkbook.Sheets(ThisWorkbook.Sheets.Count))
    resultSheet.Name = "result"
    
    ' データをExcelシートに出力する
    rowIndex = 1
    For Each line In dataArray
        columnIndex = 1
        For Each item In Split(line, ",")
            resultSheet.Cells(rowIndex, columnIndex).Value = item
            columnIndex = columnIndex + 1
        Next item
        rowIndex = rowIndex + 1
    Next line
    
    MsgBox "データの読み込みが完了しました。", vbInformation
End Su
